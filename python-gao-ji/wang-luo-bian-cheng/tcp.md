# TCP和UDP

## 简述 TCP 和 UDP 的区别以及优缺点?

UDP 是面向无连接的通讯协议，UDP 数据包括目的端口号和源端口号信息。 

优点：UDP 速度快、操作简单、要求系统资源较少，由于通讯不需要连接，可以实现广播发送 

缺点：UDP 传送数据前并不与对方建立连接，对接收到的数据也不发送确认信号，发送端不知道数 据是否会正确接收，也不重复发送，不可靠。

TCP 是面向连接的通讯协议，通过三次握手建立连接，通讯完成时四次挥手 

优点：TCP 在数据传递时，有确认、窗口、重传、阻塞等控制机制，能保证数据正确性，较为可靠。 

缺点：TCP 相对于 UDP 速度慢一点，要求系统资源较多。

## TCP连接

![&#x5EFA;&#x7ACB;TCP&#x8FDE;&#x63A5;](../../.gitbook/assets/image%20%2848%29.png)

| seq | ack | ACK | SYN | FIN |
| :--- | :--- | :--- | :--- | :--- |
| 序号字段 | 确认号字段 | 确认位 | 同步位 | 终止位 |

1. SYN=1, seq=x
2. SYN=1, ACK=1, seq=y, ack=x+1
3. ACK=1, seq=x+1, ack=y+1

![&#x91CA;&#x653E;TCP&#x8FDE;&#x63A5;](../../.gitbook/assets/image%20%2849%29.png)

1. FIN=1, seq=u
2. ACK=1, seq=v, ack=u+1
3. FIN=1, ACK=1, seq=w, ack=u+1
4. ACK=1, seq=u+1, ack=w+1 

###  为什么不采用“两次握手”建立连接？

这主要是为了防止两次握手情况下已失效的连接请求报文突然又传送到服务端，而产生了错误。考虑下面情况：客户A向服务端B发送TCP连接请求，第一个连接请求报文在网络的某个结点长时间滞留，A超时后认为报文丢失，于是再重传一次连接请求，B收到后建立连接。数据传输完毕后双方断开连接，而此时前一个滞留在网络中的连接请求到达了服务器B端，而B认为A又发送了请求，如果采用的两次握手，则这种情况下B认为传输连接已经建立，并一直等待A传输数据，而A此时并无连接请求，因此不理睬，这样就造成B资源的浪费。

### 为什么要不采用三次握手释放连接，且发送最后一次握手报文后要等待2MSL（最长报文段寿命, Maximum Segment Lifetime）的时间呢

1. 为了保证A发送的最后一个确认报文能够到达B，如果A不等待2MSL，若A返回的最后确认报文段丢失，则B不能进入正常关闭状态，而此时A已经关闭，也不可能再重传。
2. 为了防止出现“已经失效的连接请求报文”。A在发送完最后一个确认报文段后，再经过2MSL可保证本连接持续的时间内所产生的所有报文段从网络中消失。

