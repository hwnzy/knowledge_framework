# 【Go】Web框架

## net/http提供的基础服务 

 提供了基础的Web功能，像监听端口、映射静态路由、解析HTTP报文

## 上下文 Context

Web服务来说，无非是根据请求，构造响应。构造响应需要考虑消息头（header）和消息体（Body），消息头又包含状态码（Status Code）、消息类型（Content Type）等需要设置的信息。故使用Context对其进行封装，将扩展性和复杂性留在内部，对外简化接口。高效地构造出HTTP响应。

Context随着请求的出现而产生，结束而销毁。当前请求相关的信息都由 Context 承载。路由的处理函数、中间件等，参数都统一使用 Context 实例。

## 动态路由 Router

动态路由就是一条路由规则可以匹配某一类型而非某一条固定的路由。使用前缀树（Trie树）实现动态路由解析。HTTP请求路径通过/分隔成多段，每一段都可以作为前缀树的一个节点。通过对树的查询完成路由的匹配。实现的动态路由支持两个功能：1. 参数匹配（:name），2. 通配（\*file path）

## 分组控制 Group

分组是指路由的分组，对某一组路由进行相似的处理。路由分组是以相同的前缀来区分，支持分组嵌套。作用在分组上的中间件也可以作用在子分组。

## 中间件 Middle Ware

中间件的定义与路由映射的 Handler 一致，处理的输入是`Context`对象。插入点是框架接收到请求初始化`Context`对象后，允许用户使用自己定义的中间件做一些额外的处理，例如记录日志等，以及对`Context`进行二次加工。另外通过调用`(*Context).Next()`函数，中间件可等待用户自己定义的 `Handler`处理结束后，再做一些额外的操作，例如计算本次处理所用时间等。即 中间件支持用户在请求被处理的前后，做一些额外的操作。

## 模板 Template

Web 框架如何支持服务端渲染的场景。要做到服务端渲染，第一步便是要支持 JS、CSS 等静态文件。 框架所做的仅仅是解析请求的地址，映射到服务器上文件的真实地址，交给`http.FileServer`处理。第二步就是HTML模板渲染。 Go语言内置了`text/template`和`html/template`2个模板标准库， 框架的模板渲染直接使用了`html/template`提供的能力。

## 错误恢复 Panic Recover

### panic <a id="panic"></a>

Go 语言中，比较常见的错误处理方法是返回 error，由调用者决定后续如何处理。但是如果是无法恢复的错误，可以手动触发 panic，当然如果在程序运行过程中出现了类似于数组越界的错误，panic 也会被触发。panic 会中止当前执行的程序，退出。

### defer <a id="defer"></a>

 panic 会导致程序被中止，但是在退出前，会先处理完当前协程上已经defer 的任务，执行完成后再退出。效果类似于 java 语言的 `try...catch`。

### recover <a id="recover"></a>

Go 语言还提供了 recover 函数，可以避免因为 panic 发生而导致整个程序终止，recover 函数只在 defer 中生效。



