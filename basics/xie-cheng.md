# 协程

## 为什么要用协程

IO 密集型服务的瓶颈不在 CPU 处理速度，而在于尽可能快速的完成高并发、多连接下的数据读写。多线程当CPU调度给一个线程的时候，该线程可能正在I/0，浪费了CPU。

协程的调度完全由用户控制，协程拥有自己的寄存器上下文和栈，协程调度切换时，将寄存器上下文和栈保存到其他地方，在切回来的时候，恢复先前保存的寄存器上下文和栈，直接操作用户空间栈，完全没有内核切换的开销。

python项目大多使用 多进程+协程

## 协程底层实现原理

![](../.gitbook/assets/image%20%28155%29.png)

![](../.gitbook/assets/image%20%28165%29.png)

![](../.gitbook/assets/image%20%28152%29.png)

![](../.gitbook/assets/image%20%28150%29.png)

## python生成器实现原理

python 2.5 中引入 yield/send 表达式用于实现协程

![](../.gitbook/assets/image%20%28159%29.png)

