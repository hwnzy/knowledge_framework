# 后端面试

## 后端面试

基础 

## ★★★ 进程与线程的本质区别、以及各自的使用场景。

1. 进程

进程是资源（CPU、内存等）分配的基本单位，它是程序执行时的一个实例。

程序运行时系统就会创建一个进程，并为它分配资源，然后把该进程放入进程就绪队列

进程调度器选中它的时候就会为它分配CPU时间，程序开始真正运行。

1.1 进程的状态和切换

* 就绪状态：进程已获得除处理机以外的所需资源，等待分配处理机资源
* 运行状态：占用处理机资源运行，处于此状态的进程数小于等于CPU数
* 阻塞状态： 进程等待某种条件，在条件满足之前无法执行

操作系统为了控制进程的执行，必须有能力挂起正在CPU上运行的进程，并恢复以前挂起的某个进程的执行，这种行为被称为进程切换，任务切换或上下文切换。  


![](../.gitbook/assets/image%20%2899%29.png)

![](../.gitbook/assets/image%20%28100%29.png)

2. 什么是线程

线程是程序执行时的最小单位，它是进程的一个执行流，是CPU调度和分派的基本单位。

一个进程可以由很多个线程组成，线程间共享进程的所有资源，每个线程有自己的堆栈和局部变量。

线程由CPU独立调度执行，在多CPU环境下就允许多个线程同时运行。同样多线程也可以实现并发操作，每个请求分配一个线程来处理。

3. 进行和线程之间的区别

1. 调度 ：在引入线程的操作系统中，线程是调度和分配的基本单位 ，进程是资源拥有的基本单位 。把传统进程的两个属性分开，线程便能轻装运行，从而可 显著地提高系统的并发程度 。在同一进程中，线程的切换不会引起进程的切换；在由一个进程中的线程切换到另一个进程中的线程时，才会引起进程的切换。
2. 并发性 ：在引入线程的操作系统中，不仅进程之间可以并发执行，而且在一个进程中的多个线程之间亦可并发执行，因而使操作系统具有更好的并发性，从而能 更有效地使用系统资源和提高系统吞吐量。
3. 拥有资源 ：不论是传统的操作系统，还是设有线程的操作系统，进程都是拥有资源的一个独立单位，它可以拥有自己的资源。一般地说，线程自己不拥有系统资源（只有一些必不可少的资源，但它可以访问其隶属进程的资源。
4. 系统开销：由于在创建或撤消进程时，系统都要为之分配或回收资源，因此，操作系统所付出的开销将显著地大于在创建或撤消线程时的开销。进程切换的开销也远大于线程切换的开销。
5. 通信：进程间通信IPC，线程间可以直接读写进程数据段（如全局变量）来进行通信——需要进程同步和互斥手段的辅助，以保证数据的一致性，因此共享简单。但是线程的数据同步要比进程略复杂。

4. 进行和线程之间的相同点

进程和线程都有ID/寄存器组、状态和优先权、信息块，创建后都可更改自己的属性，都可与父进程共享资源、都不能直接访问其他无关进程或线程的资源

5. 进程和线程的使用场景

有了以上进程和线程的异同点，不难得出结论：

1. 需要频繁创建销毁的优先使用线程；因为对进程来说创建和销毁一个进程代价是很大的。
2. 线程的切换速度快，所以在需要大量计算，切换频繁时用线程，还有耗时的操作使用线程可提高应用程序的响应
3. 因为对CPU系统的效率使用上线程更占优，所以可能要发展到多机分布的用进程，多核分布用线程；
4. 并行操作时使用线程，如C/S架构的服务器端并发线程响应用户的请求；
5. 需要更稳定安全时，适合选择进程；需要速度时，选择线程更好。

## ★☆☆ 进程状态。 

* 就绪状态：进程已获得除处理机以外的所需资源，等待分配处理机资源
* 运行状态：占用处理机资源运行，处于此状态的进程数小于等于CPU数
* 阻塞状态： 进程等待某种条件，在条件满足之前无法执行

操作系统为了控制进程的执行，必须有能力挂起正在CPU上运行的进程，并恢复以前挂起的某个进程的执行，这种行为被称为进程切换，任务切换或上下文切换。

## ★★★ 进程调度算法的特点以及使用场景。 

1、时间片轮转调度算法（RR）：给每个进程固定的执行时间，根据进程到达的先后顺序让进程在单位时间片内执行，执行完成后便调度下一个进程执行，时间片轮转调度不考虑进程等待时间和执行时间，属于抢占式调度。优点是兼顾长短作业；缺点是平均等待时间较长，上下文切换较费时。适用于分时系统。

2、先来先服务调度算法（FCFS）：根据进程到达的先后顺序执行进程，不考虑等待时间和执行时间，会产生饥饿现象。属于非抢占式调度，优点是公平，实现简单；缺点是不利于短作业。

3、优先级调度算法（HPF）：在进程等待队列中选择优先级最高的来执行。常被用于批处理系统中，还可用于实时系统中。

4、多级反馈队列调度算法：将时间片轮转与优先级调度相结合，把进程按优先级分成不同的队列，先按优先级调度，优先级相同的，按时间片轮转。优点是兼顾长短作业，有较好的响应时间，可行性强，适用于各种作业环境。

5、高响应比优先调度算法：根据“响应比=（进程执行时间+进程等待时间）/ 进程执行时间”这个公式得到的响应比来进行调度。高响应比优先算法在等待时间相同的情况下，作业执行的时间越短，响应比越高，满足段任务优先，同时响应比会随着等待时间增加而变大，优先级会提高，能够避免饥饿现象。优点是兼顾长短作业，缺点是计算响应比开销大，适用于批处理系统。

★☆☆ 线程实现的方式。 

线程的3种实现方式

在引入线程的操作系统中，进程是资源分配的基本单位，线程是独立调度的基本单位。在同一进程中，线程的切换不会引起进程切换。在不同进程中进行线程切换,如从一个进程内的线程切换到另一个进程中的线程时，会引起进程切换。

线程分为两种：

| 名称 | 描述 |
| :--- | :--- |
| 用户级线程\(User-Level Thread, ULT\) | 由应用程序所支持的线程实现, 对内核不可见 |
| 内核级线程\(Kernel-Level Thread, KLT\) | 内核级线程又称为内核支持的线程 |

组合线程\(Hybrid Multithreading\)是一种别的实现方式而不是线程的种类。

★★☆ 协程的作用。 

1.协程的含义和实现

协程是单进程单线程的超越函数的调度机制，它通过一定的调度手段进行调度。

（Python使用generator机制，greenlet使用汇编控制对程序指向来实现）。

2.协程有什么作用

计算机分为IO bound 和CPU bound两种类型的task。在这两种情况中，协程都没有什么作用。

为什么？

在CPU bound task中，cpu被用来执行任务去了。这类task，即使一个一个方法的执行，跟协程的效率还要高出一点点，使用协程没有意义。IO bound task中，CPU已经陷入系统调用之中，用户空间的调度无论如何也是没有CPU的，这样情况下，协程只能死死的。在这样情况下，祈求高效率，怎么可能。

协程只有在非常有限制的情况下，才有一些用处，在单进程单线程任务中的交互青霞，才有它的用武之地。

3.协程不是未来（反驳赖勇浩）。协程是很早之前就有的。很早之前，windows就有纤程的概念，Linux不太确定。但是它一直作为小众的API而存在。

4.gevnet+flask是一个很流行的用法，但是gevent真正有用的是libev，它是使用epoll\(linux\), kqueue\(bsd\),IOCP\(windows\)实现network IO，并在轮询处理signal，signal，callback的lib。

★★☆ 常见进程同步问题。 

 生产者-消费者（三个信号量）

empty：缓冲区 空闲 资源数，full：缓冲区 已满 资源数 ： 保证不会空时消费，满时生产（保证顺序、同步） mutex 代表互斥锁 ： 保证同一时间只有一个线程可以访问共享资源（互斥访问）

 读者-写者问题 （可以多个进程同时读，但是写时就只能有一个写）

wmutex： 互斥的写 （写时不能读，只能一个写） rmutex： 互斥的使用readcount（对readcount加锁） readcount： 统计读进程数目，及读者数量（临界资源，多个读进程共享）

 哲学家进餐问题 ： 只允许同时拿起左右两边的筷子

mutex: 互斥量，对拿起左右两只筷子加锁（只有一个进程能访问）

★★★ 进程通信方法的特点以及使用场景。

一、共享内存通信

共享内存是指多个进程共享一块内存，是专门用来解决不同进程之间的通信问题的，由于是直接对内存进行数据传输操作，所以是速度最快的IPC（inter-process communication）方式，因为是共享内存，所以需要配合信号量机制实现同步。

二、管道通信

无名管道\( pipe \)：管道是一种半双工的通信方式，数据只能单向流动，而且只能在具有亲缘关系的进程间使用。进程的亲缘关系通常是指父子进程关系。

当一个管道建立时，它会创建两个文件描述符：`fd[0]`为读而打开，`fd[1]`为写而打开。如下图：

![](https://img-blog.csdnimg.cn/20190731095842458.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5NTA3NzIz,size_16,color_FFFFFF,t_70)

高级管道\(popen\)：将另一个程序当做一个新的进程在当前程序进程中启动，则它算是当前程序的子进程，这种方式我们成为高级管道方式。

有名管道 \(named pipe\) ： 有名管道也是半双工的通信方式，但是它允许无亲缘关系进程间的通信。

三、消息队列通信

消息队列\( message queue \) ： 消息队列是由消息的链表，存放在内核中并由消息队列标识符标识。消息队列克服了信号传递信息少、管道只能承载无格式字节流以及缓冲区大小受限等缺点。

四、套接字通信

套接字\( socket \) ： 套解口也是一种进程间通信机制，与其他通信机制不同的是，它可用于不同机器间的进程通信。

★★★ 死锁必要条件、解决死锁策略，能写出和分析死锁的代码，能说明在数据库管理系统或者 Java 中如何解决死锁。 

必要条件：

互斥条件（Mutual exclusion）：资源不能被共享，只能由一个进程使用。 

请求与保持条件（Hold and wait）：已经得到资源的进程可以再次申请新的资源。 

不可剥夺剥夺条件（No pre-emption）：已经分配的资源不能从相应的进程中被强制地剥夺。 

环路等待条件（Circular wait）：系统中若干进程组成环路，该环路中每个进程都在等待相邻进程正占用的资源。

解决策略：

1\) 死锁预防：预先静态分配法：破坏了“不可剥夺条件”，资源有序分配法：破坏了“环路条件”

2）死锁避免：设法破坏4个必要条件之一，严格防止死锁的发生。银行家算法：若发现分配资源后进入不安全状态，则不予分配；若扔处于安全状态，则实施分配。

3）死锁检测：允许死锁产生，定时地运行一个死锁检测程序，判断系统是否发生死锁。

4）死锁解除：资源剥夺法，撤销进程法

★★★ 虚拟内存的作用，分页系统实现虚拟内存原理。 

虚拟内存是计算机系统内存管理的一种技术。它使得应用程序认为它拥有连续可用的内存（一个连续完整的地址空间），而实际上，它通常是被分隔成多个物理内存碎片，还有部分暂时存储在外部磁盘存储器上，在需要时进行数据交换。 

虚拟地址被分成虚拟页号（高地址）和偏移量（低地址）两部分。不同的划分对应了不同的页面大小。

 虚拟页号可作为页表的索引，以找到该虚拟页面对应的页表项。由页表项可以找到对应的页框。然后把页框号拼接到偏移量的高位端，以替换调虚拟页号，形成送往内存的物理地址。 

★★★ 页面置换算法的原理，特别是 LRU 的实现原理，最好能手写，再说明它在 Redis 等作为缓存置换算法。 



★★★ 比较分页与分段的区别。 

★★★ 分析静态链接的不足，以及动态链接的特点。

Linux

★★☆ 文件系统的原理，特别是 inode 和 block。数据恢复原理。 ★★★ 硬链接与软链接的区别。 ★★☆ 能够使用常用的命令，比如 cat 文件内容查看、find 搜索文件，以及 cut、sort 等管线命令。了解 grep 和 awk 的作用。 ★★★ 僵尸进程与孤儿进程的区别，从 SIGCHLD 分析产生僵尸进程的原因。网络基础★★★ 各层协议的作用，以及 TCP/IP 协议的特点。 ★★☆ 以太网的特点，以及帧结构。 ★★☆ 集线器、交换机、路由器的作用，以及所属的网络层。 ★★☆ IP 数据数据报常见字段的作用。 ★☆☆ ARP 协议的作用，以及维护 ARP 缓存的过程。 ★★☆ ICMP 报文种类以及作用；和 IP 数据报的关系；Ping 和 Traceroute 的具体原理。 ★★★ UDP 与 TCP 比较，分析上层协议应该使用 UDP 还是 TCP。 ★★★ 理解三次握手以及四次挥手具体过程，三次握手的原因、四次挥手原因、TIME\_WAIT 的作用。 ★★★ 可靠传输原理，并设计可靠 UDP 协议。 ★★☆ TCP 拥塞控制的作用，理解具体原理。 ★★☆ DNS 的端口号；TCP 还是 UDP；作为缓存、负载均衡。HTTP★★★ GET 与 POST 比较：作用、参数、安全性、幂等性、可缓存。 ★★☆ HTTP 状态码。 ★★★ Cookie 作用、安全性问题、和 Session 的比较。 ★★☆ 缓存 的 Cache-Control 字段，特别是 Expires 和 max-age 的区别。ETag 验证原理。 ★★★ 长连接与短连接原理以及使用场景，流水线。 ★★★ HTTP 存在的安全性问题，以及 HTTPs 的加密、认证和完整性保护作用。 ★★☆ HTTP/1.x 的缺陷，以及 HTTP/2 的特点。 ★★★ HTTP/1.1 的特性。 ★★☆ HTTP 与 FTP 的比较。Socket★★☆ 五种 IO 模型的特点以及比较。 ★★★ select、poll、epoll 的原理、比较、以及使用场景；epoll 的水平触发与边缘触发。数据库SQL★★☆ 手写 SQL 语句，特别是连接查询与分组查询。 ★★☆ 连接查询与子查询的比较。 ★★☆ drop、delete、truncate 比较。 ★★☆ 视图的作用，以及何时能更新视图。 ★☆☆ 理解存储过程、触发器等作用。系统原理★★★ ACID 的作用以及实现原理。 ★★★ 四大隔离级别，以及不可重复读和幻影读的出现原因。 ★★☆ 封锁的类型以及粒度，两段锁协议，隐式和显示锁定。 ★★★ 乐观锁与悲观锁。 ★★★ MVCC 原理，当前读以及快照读，Next-Key Locks 解决幻影读。 ★★☆ 范式理论。 ★★★ SQL 与 NoSQL 的比较。MySQL★★★ B+ Tree 原理，与其它查找树的比较。 ★★★ MySQL 索引以及优化。 ★★★ 查询优化。 ★★★ InnoDB 与 MyISAM 比较。 ★★☆ 水平切分与垂直切分。 ★★☆ 主从复制原理、作用、实现。 ★☆☆ redo、undo、binlog 日志的作用。Redis★★☆ 字典和跳跃表原理分析。 ★★★ 使用场景。 ★★★ 与 Memchached 的比较。 ★☆☆ 数据淘汰机制。 ★★☆ RDB 和 AOF 持久化机制。 ★★☆ 事件驱动模型。 ★☆☆ 主从复制原理。 ★★★ 集群与分布式。 ★★☆ 事务原理。 ★★★ 线程安全问题。

